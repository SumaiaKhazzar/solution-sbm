# This is autogenerated - do not touch!
name: Start deployment
# We use this workflow within each solution repository to proxy a dispatch request
# to lime-docker-terraform because we want to use personal tokens in the local environment
# and keep the lime-ci token as a github secret.

on:
  repository_dispatch:
    types: [add-sqs-queue]

jobs:
  dispatch:
    name: Start deployment
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ ubuntu-latest ]
    steps:
      - uses: actions/checkout@v2
      - name: Create dispatch for lime-docker-terraform
        uses: Lundalogik/repository-dispatch@v1
        with:
          token: ${{ secrets.DISPATCH_TOKEN }}
          event-type: "emit-deployment-message"
          repository: Lundalogik/lime-docker-terraform
          client-payload: |
              {
                "repository" : "${{ github.event.client_payload.repository }}",
                "deployplan_id" : "${{ github.event.client_payload.deployplan_id }}",
                "image_tag" : "${{ github.event.client_payload.image_tag }}",
                "env" : "${{ github.event.client_payload.env }}",
                "app_identifier" : "${{ github.event.client_payload.app_identifier }}",
                "process": "${{ github.event.client_payload.process }}",
                "user": "${{ github.event.client_payload.user }}"
              }